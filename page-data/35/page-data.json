{"componentChunkName":"component---src-templates-blog-post-js","path":"/35/","result":{"data":{"site":{"siteMetadata":{"author":"weijiew","homeCity":"China"}},"markdownRemark":{"html":"<h1>前言</h1>\n<p>最近在清洗一批数据，大约有一千多个文件。如果手动处理，一个文件最快的话需要一分钟。但是这个状态需要精神高度集中，手速不能慢，无法持续太久。</p>\n<p>数据的形状如下：</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3b479076c61b7d157ee70bcd41fc71b/7cb89/d1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 563px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 70.94594594594594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACGElEQVQ4y32T2XLaQBBF5/+fkqpUJU9Q2GYHCbSvmB0hIREWI3bDl9z0DAXGDsnDKVq3+7Z6mhFTVRVf0XUDjYaMarmAWrWISvkFpeITCvmc0DRNEzzyMsMwcI9pmpClGkr5LKqVApSmTIVNQkGtVkIu8wtPP39AkSRYtn3zXP3McRxcsOG6LkxDQ50msiwTnucLzSH4L3/mcTGXwfO37zA1HR/+C8z3fVxowaNiVa7A91y0Wq+kefjI+7fndqcDKUfHz2bpJZ9rWLvdBqdDRZ5rwbUNiru46o/odLvwbQe1TOavHOv3++j1ehgMBnRMlSbzRNwnjeceweuHoxGUShkerWowHAqN59iIEoJgBN2UaLo2giDATX/AkBqEUQRNlom6iLnGcywMQ0RhhHEYQNWrYroomoDr/yNOEji6DltpIplOEY7HQmcJJZKYmCbQtYb4Q2azGeI4hsg9IJ5MMFssYNHVadFtmM3nt3rGzZw5iQmJtqHjqv2b36K++fIsmvP4mmPL5RJX0jSFT0t+pauwXq9xnxPQVAtit9/Dp+Na9GWk6/RTDeNGDm92abKATcUBLXm73WK722Gz2Qh4o8PhQLtTIRULosG9l8N2ZLjCG3DDnEZXZAku7YevYbVaYfX2hmgcoF7IQyoVka5S7OkFO/Lc92DH4xFfOZ1OZFihT5edN/Xpk9KaDbGOQbdDNe84n8945P0DwTKZX7HDkiEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"d1\"\n        title=\"\"\n        src=\"/static/c3b479076c61b7d157ee70bcd41fc71b/7cb89/d1.png\"\n        srcset=\"/static/c3b479076c61b7d157ee70bcd41fc71b/12f09/d1.png 148w,\n/static/c3b479076c61b7d157ee70bcd41fc71b/e4a3f/d1.png 295w,\n/static/c3b479076c61b7d157ee70bcd41fc71b/7cb89/d1.png 563w\"\n        sizes=\"(max-width: 563px) 100vw, 563px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/af2ba0392553254b189842e3c30c9a33/29579/d1-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 543px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 78.37837837837837%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACyUlEQVQ4y21UaU8iQRCd//9pN9kruxqTXSUqN8zAXMwJDPclhwqioBGy/oi3rxvGiO6Hl5ruqnpV9apB0XUd72EYJgzThKoWoRYLKJVUaKqwGv1l6IaxQ7n8IVexLAsHEESFLM4TJ0icHuHszxFOf/+U53QqgWz6AvlsCmWS27aN9/mK4zgQcF0XTqUCXctDzSdRyKVIbtDnwqTN5zLIZi6RTp4jl7pAIXkJnRPIvD2HgOL7PjzPQ8UyYekaLEODY5sIeB8EIXxpA9oAOkcvkriUz0FLJqFdJpln7f2+hFKtVhGGATynAtex4HsOyVxUqzUI3ytqNVnEsQyY1FVPpWHkCzA1FSEJ43gliiLU6zVJ6jg2R7DluRE1IHxv0Wg2EXguKpoGV9VQ4RIcThYGPhqNXbzSardQj6qSxA8ceL4tne12G61W6wDxncPtuiQLqHlA3VosFPuUXq/HcTwiQNQUxFV02h2I+16vu7c7dLs89/uocUSP2rlCa9dhfHsXQ78yGA44O7WpWIjqdYTUSVQbDocfMRhgNBqhSsKA2/Wpe1CxJdGQ9yJGGY/HspPQ92RgRPG73Q4mkwmE739osHCb4/nUL3I9XF2NXn3K9fW1/Oh2qEGzgVoYSoxYTfhms9kBJqIBdtRkYa+oYkDit3HKfD6XH71OR5JGNT4jvssux17c3eH29naHmxvMFwsMqWGdW61ZNgIuZspJBEccp9wx6f7+HuOrq/0oTbk1Qd7ht/Avl0s8PDzIxBZfg1cqoZTJyKJL5oqYGIoIFFiv1xhR9CbfkkehLf4JiE7FnSg4nYxh8ZeSPvuDYiqJPscWOXF+DOXp6QmPj48QVnTS54Ia7MJkF7lUCsc/vuH750/49fULEifHsMolLDj6ZrOReXFuDEU4XrHdyMvn52esVitMKMOIz2o2nWK9WmO73eLvy4u0IuYgd49/Y/gqL84vacwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"d1 1\"\n        title=\"\"\n        src=\"/static/af2ba0392553254b189842e3c30c9a33/29579/d1-1.png\"\n        srcset=\"/static/af2ba0392553254b189842e3c30c9a33/12f09/d1-1.png 148w,\n/static/af2ba0392553254b189842e3c30c9a33/e4a3f/d1-1.png 295w,\n/static/af2ba0392553254b189842e3c30c9a33/29579/d1-1.png 543w\"\n        sizes=\"(max-width: 543px) 100vw, 543px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>需要清除的点则是：</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1df63f04dee5bc000c825cea86e89cb4/a1d58/d2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 233px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 79.72972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACMElEQVQ4y6WUS3PTMBSF9WtZs2PDilVnYAPMUJqSR5P4kdixLMuW347TptB/dXrk9AUlpTMsvpGte3TuvfIdi1gpyDiGjCJIKf8bETgLyDBEkmaIafx6WIhUSJIYWj/ui8B1sPFc+BczqIQCrSlSdyTPUCrhwQRZqlDmMcJI48IxCDcamnHhTqfYrHysZzMErjdsapoeIzcJ2krBXRucfO3w6bSFHxik6SEuguViyCwdD/54wkCKLMse1gMp3zMUeYqpU+HN+194++EaZxc1E6TI80PcaoWSEUK27X0/QzBfIPZWMMY8wyaoygwfT3u8O9mjKDI0NZMylj3RieX4HCHvUAZrhPM5gh9jhIslcmYrypLZc3IQ2+emNui7bHg2priLPzJUaFuKaOZ9O4U/OmeVPtzRCMaaFsVASXNLUTBJUT68/4nIM41UbqCVRDiZQC1dGJ1CbTZDxVZU1zWqqnoVoqE44yzlrDLxfWjHR7IOUbBFS8phLVlh07SD8b8QbduioXNBQ8PZU9M59GoNw49Q232TcT+hac4KSlj9S4iu67Dd9nQ/HI7ORnA+f8FqOoGN1Wy5YoWGc2YP2L2XEH3f03ALu+4uLzk6MyST2VBlphOkscS236JrmwedXY8hdrsd7umJUbxPO4s+DfnjqHiPXdMcEj7RHkNcsqrfuLqC9jzEHPKGrdakZ+ZnuiOI/X6Pe65o9vPmBnkksZqMkbPdisPa8evtr6+H+FP937gF0OXld+0UkhUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"d2\"\n        title=\"\"\n        src=\"/static/1df63f04dee5bc000c825cea86e89cb4/a1d58/d2.png\"\n        srcset=\"/static/1df63f04dee5bc000c825cea86e89cb4/12f09/d2.png 148w,\n/static/1df63f04dee5bc000c825cea86e89cb4/a1d58/d2.png 233w\"\n        sizes=\"(max-width: 233px) 100vw, 233px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>圆柱体周围有很多噪点，需要清除。</p>\n<h1>思考</h1>\n<p>我最初的想法步骤如下：</p>\n<ol>\n<li>根据坐标得到圆柱体的的中心。</li>\n<li>根据 Z 轴得到圆柱体的高的范围，根据范围将圆柱体分为多层。</li>\n<li>抽出每一层，极限的思想，想象成一个圆环（虽然高存在，这也是误差的一部分）。</li>\n<li>根据 Y 轴将圆切成两半，扫描完一半在扫描另一半。</li>\n<li>根据 X 轴的范围来切分数据，将数据分为多多份。</li>\n<li>此时存在多份数据，计算每一份数据距离中心的均值，将和均值差别较大的删除。</li>\n</ol>\n<p>误差来源：</p>\n<ol>\n<li>因为高的存在，所有以根据三角函数，剔除的数据需要设定一个合理范围，范围大了删不掉异常值，范围小了会将圆环的上下部分删掉。</li>\n<li>因为是无差别的切分，所以异常点单独为一份无法计算均值剔除，这也是误差最严重的部分！</li>\n<li>写代码的时候存在一个 python 返回值的问题，索引方面的问题。</li>\n<li>在我手动清理的时候发现数据范围差别较大，即时调试好参数也只是在当前的数据上表现良好。</li>\n</ol>\n<p>”残废“代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> math\n<span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n\n<span class=\"token comment\"># 输入文件所在路径批量修改文件后缀</span>\n\n<span class=\"token comment\"># txt 转 csv</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">txt_to_csv</span><span class=\"token punctuation\">(</span>txtFile<span class=\"token punctuation\">,</span>csvFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    d_read <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span>txtFile<span class=\"token punctuation\">,</span> index_col<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> skiprows<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span>\n    d_write <span class=\"token operator\">=</span> d_read<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">,</span> <span class=\"token string\">','</span><span class=\"token punctuation\">)</span>\n    d_write<span class=\"token punctuation\">.</span>to_csv<span class=\"token punctuation\">(</span>csvFile<span class=\"token punctuation\">,</span> index<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># vtx => txt  </span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">modifyFile</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> filename <span class=\"token keyword\">in</span> os<span class=\"token punctuation\">.</span>listdir<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        os<span class=\"token punctuation\">.</span>rename<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".txt\"</span><span class=\"token punctuation\">)</span>\n        txt_to_csv<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".txt\"</span><span class=\"token punctuation\">,</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".csv\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">readPath</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> p <span class=\"token keyword\">in</span> os<span class=\"token punctuation\">.</span>listdir<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        fullPath <span class=\"token operator\">=</span> path <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\\"</span><span class=\"token operator\">+</span> p \n        modifyFile<span class=\"token punctuation\">(</span>fullPath<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">calZData</span><span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># 计算 Z 轴最值，</span>\n    z_max<span class=\"token punctuation\">,</span> z_min <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> df<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    index <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>arange<span class=\"token punctuation\">(</span>z_min<span class=\"token punctuation\">,</span> z_max<span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n    i <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    delFrame <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">while</span> i <span class=\"token operator\">&lt;</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        tmpData <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>loc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">[</span>i<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;=</span> df<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> index<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n        delData1 <span class=\"token operator\">=</span> calXData<span class=\"token punctuation\">(</span>tmpData<span class=\"token punctuation\">)</span>\n        delFrame <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span>delFrame<span class=\"token punctuation\">,</span>delData1<span class=\"token punctuation\">)</span>\n        i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"已经删除一圈啦！！！\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> delFrame\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">calXData</span><span class=\"token punctuation\">(</span>df_z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token comment\"># 切分 X 轴</span>\n    x_max<span class=\"token punctuation\">,</span> x_min <span class=\"token operator\">=</span> df_z<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> df_z<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    index <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>arange<span class=\"token punctuation\">(</span>x_min<span class=\"token punctuation\">,</span> x_max<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n    i <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    frame <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">while</span> i <span class=\"token operator\">&lt;</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        \n        <span class=\"token comment\"># 处理 Y 轴</span>\n        midValue <span class=\"token operator\">=</span>  df_z<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        df_xy <span class=\"token operator\">=</span> df_z<span class=\"token punctuation\">.</span>loc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>df_z<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">>=</span> index<span class=\"token punctuation\">[</span>i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span>\n                    <span class=\"token punctuation\">(</span>df_z<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> index<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span>\n                    <span class=\"token punctuation\">(</span>df_z<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> midValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n        df_xy <span class=\"token operator\">=</span> df_z<span class=\"token punctuation\">.</span>loc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>df_z<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">>=</span> index<span class=\"token punctuation\">[</span>i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span>\n                    <span class=\"token punctuation\">(</span>df_z<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> index<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span>\n                    <span class=\"token punctuation\">(</span>df_z<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;=</span> midValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n        \n        del1 <span class=\"token operator\">=</span> delData<span class=\"token punctuation\">(</span>df_xy<span class=\"token punctuation\">)</span>\n        del2 <span class=\"token operator\">=</span> delData<span class=\"token punctuation\">(</span>df_xy<span class=\"token punctuation\">)</span>\n        frame <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>del1<span class=\"token punctuation\">,</span> del2<span class=\"token punctuation\">]</span>\n        i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n    frame <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> frame\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">delData</span><span class=\"token punctuation\">(</span>df_xy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">global</span> x_mean<span class=\"token punctuation\">,</span> y_mean<span class=\"token punctuation\">,</span> z_mean<span class=\"token punctuation\">,</span> df\n\n    val <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>square<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>df_xy<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>x_mean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n                  np<span class=\"token punctuation\">.</span>square<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>df_xy<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>y_mean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n                  np<span class=\"token punctuation\">.</span>square<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>df_xy<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>z_mean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    val_mean <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span>\n    \n    delIndex <span class=\"token operator\">=</span> val<span class=\"token punctuation\">.</span>loc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>val <span class=\"token operator\">/</span> val_mean<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.95</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>val <span class=\"token operator\">/</span> val_mean<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">1.05</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"已经删除一块啦！\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> np<span class=\"token punctuation\">.</span>isnan<span class=\"token punctuation\">(</span>delIndex<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> delIndex\n    \n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    filePath <span class=\"token operator\">=</span> <span class=\"token string\">\"F:\\\\DA\\\\test\\\\1728_002_Stem_Data(Undo)\\\\1728_002_Stem_Data_0.csv\"</span>\n    df <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span>\n    x_mean <span class=\"token punctuation\">,</span> y_mean<span class=\"token punctuation\">,</span> z_mean <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> df<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> df<span class=\"token punctuation\">.</span>iloc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Delete data bofore ：\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    delIndexFrmae <span class=\"token operator\">=</span> calZData<span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">)</span>\n    df_c <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>drop<span class=\"token punctuation\">(</span>delIndexFrmae<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Delete data after  ：\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>df_c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h1>总结</h1>\n<p>通过这次失败的尝试，学习了 python 的数据格式转换。</p>\n<p>python 对于 vtx 数据格式的文件没有很好的处理库，通过修改文件名的方式我将其转为了 txt 格式。</p>\n<p>采用 pandas 将 txt 格式的数据转为了 csv 格式，然后处理 csv 数据。</p>\n<p>pandas 的 drop 函数在删数据的时候是传值，而我需要的则是传址，pandas 中没有找到一个合适的 API 。 del 似乎可以解决，当我意识到误差无法避免时就没有接着处理这个问题了。</p>\n<p>再次学习了 pandas 的条件索引，确实非常强大，不需要循环就可以搞定！</p>\n<p>最近粗读了一下《python 数据分析》，pandas 作者出的书，有一些帮助。</p>","excerpt":"…","fields":{"tagSlugs":["/tags/思考/"]},"frontmatter":{"title":"记录一次“失败“的数据清洗","tags":["思考"],"date":"October 04, 2020"}}},"pageContext":{"slug":"/35/"}},"staticQueryHashes":[]}